<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P2P –ö—Ä–µ—Å—Ç–∏–∫–∏-–ù–æ–ª–∏–∫–∏ - GitHub Pages</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            color: white;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        
        .lobby {
            margin: 20px 0;
        }
        
        input {
            padding: 10px;
            margin: 10px;
            border: none;
            border-radius: 5px;
            width: 200px;
        }
        
        button {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s ease;
        }
        
        button:hover {
            background: #ff5252;
            transform: translateY(-2px);
        }
        
        .board {
            display: grid;
            grid-template-columns: repeat(3, 100px);
            grid-template-rows: repeat(3, 100px);
            gap: 5px;
            margin: 20px auto;
            width: 310px;
        }
        
        .cell {
            width: 100px;
            height: 100px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .cell.x { color: #ff6b6b; }
        .cell.o { color: #4ecdc4; }
        
        .status {
            font-size: 20px;
            font-weight: bold;
            margin: 15px 0;
            min-height: 30px;
        }
        
        .game-code {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px;
            border-radius: 10px;
            margin: 10px 0;
            font-size: 18px;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ P2P –ö—Ä–µ—Å—Ç–∏–∫–∏-–ù–æ–ª–∏–∫–∏</h1>
        
        <!-- –õ–æ–±–±–∏ -->
        <div id="lobby" class="lobby">
            <div>
                <button onclick="createGame()">–°–æ–∑–¥–∞—Ç—å –∏–≥—Ä—É</button>
                <button onclick="showJoinForm()">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</button>
            </div>
            
            <div id="joinForm" class="hidden">
                <input type="text" id="gameCodeInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–≥—Ä—ã">
                <button onclick="joinGame()">–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è</button>
            </div>
        </div>
        
        <!-- –ò–≥—Ä–æ–≤–∞—è –∑–æ–Ω–∞ -->
        <div id="gameArea" class="hidden">
            <div id="status" class="status">–û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...</div>
            
            <div class="game-code">
                –ö–æ–¥ –∏–≥—Ä—ã: <strong id="gameCodeDisplay"></strong>
            </div>
            
            <div class="board" id="gameBoard">
                <div class="cell" onclick="makeMove(0)"></div>
                <div class="cell" onclick="makeMove(1)"></div>
                <div class="cell" onclick="makeMove(2)"></div>
                <div class="cell" onclick="makeMove(3)"></div>
                <div class="cell" onclick="makeMove(4)"></div>
                <div class="cell" onclick="makeMove(5)"></div>
                <div class="cell" onclick="makeMove(6)"></div>
                <div class="cell" onclick="makeMove(7)"></div>
                <div class="cell" onclick="makeMove(8)"></div>
            </div>
            
            <button onclick="resetGame()">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
            <button onclick="leaveGame()">–í—ã–π—Ç–∏ –∏–∑ –∏–≥—Ä—ã</button>
        </div>
    </div>

    <script>
        class PeerToPeerGame {
            constructor() {
                this.peer = null;
                this.conn = null;
                this.gameId = null;
                this.playerSymbol = null;
                this.currentPlayer = 'X';
                this.board = ['', '', '', '', '', '', '', '', ''];
                this.gameActive = false;
                this.isMyTurn = false;
                this.isHost = false;
                
                this.init();
            }
            
            init() {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º PeerJS –¥–ª—è P2P —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
                this.loadPeerJS();
            }
            
            loadPeerJS() {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º PeerJS –±–∏–±–ª–∏–æ—Ç–µ–∫—É
                const script = document.createElement('script');
                script.src = 'https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js';
                script.onload = () => {
                    console.log('PeerJS loaded');
                };
                document.head.appendChild(script);
            }
            
            createGame() {
                this.isHost = true;
                this.playerSymbol = 'X';
                this.isMyTurn = true;
                
                // –°–æ–∑–¥–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π ID –∏–≥—Ä—ã
                this.gameId = this.generateGameId();
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Peer
                this.peer = new Peer(this.gameId);
                
                this.peer.on('open', (id) => {
                    this.showGameArea();
                    document.getElementById('gameCodeDisplay').textContent = id;
                    this.updateStatus('–û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞...');
                });
                
                this.peer.on('connection', (conn) => {
                    this.conn = conn;
                    this.setupConnection();
                    this.gameActive = true;
                    this.updateStatus('–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω! –í–∞—à —Ö–æ–¥ (X)');
                });
                
                this.peer.on('error', (err) => {
                    console.error('Peer error:', err);
                    this.updateStatus('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è');
                });
            }
            
            joinGame(gameId) {
                this.isHost = false;
                this.playerSymbol = 'O';
                this.isMyTurn = false;
                this.gameId = gameId;
                
                this.peer = new Peer();
                
                this.peer.on('open', (id) => {
                    this.conn = this.peer.connect(gameId);
                    this.setupConnection();
                    this.showGameArea();
                    document.getElementById('gameCodeDisplay').textContent = gameId;
                });
                
                this.peer.on('error', (err) => {
                    console.error('Peer error:', err);
                    this.updateStatus('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–¥ –∏–≥—Ä—ã.');
                });
            }
            
            setupConnection() {
                this.conn.on('open', () => {
                    this.gameActive = true;
                    this.updateStatus(`–ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å! –í—ã –∏–≥—Ä–∞–µ—Ç–µ –∑–∞ ${this.playerSymbol}`);
                    this.updateBoard();
                    
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                    this.sendData({
                        type: 'player_joined',
                        symbol: this.playerSymbol
                    });
                });
                
                this.conn.on('data', (data) => {
                    this.handleData(data);
                });
                
                this.conn.on('close', () => {
                    this.updateStatus('–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫ –æ—Ç–∫–ª—é—á–∏–ª—Å—è');
                    this.gameActive = false;
                });
            }
            
            handleData(data) {
                switch (data.type) {
                    case 'player_joined':
                        this.updateStatus('–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω! –ù–∞—á–∏–Ω–∞–µ–º –∏–≥—Ä—É.');
                        break;
                        
                    case 'move':
                        this.board[data.position] = data.symbol;
                        this.currentPlayer = data.symbol === 'X' ? 'O' : 'X';
                        this.isMyTurn = this.playerSymbol === this.currentPlayer;
                        this.updateBoard();
                        this.checkGameStatus();
                        break;
                        
                    case 'reset':
                        this.resetGame();
                        this.updateStatus('–ù–æ–≤–∞—è –∏–≥—Ä–∞! ' + (this.isMyTurn ? '–í–∞—à —Ö–æ–¥' : '–•–æ–¥ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞'));
                        break;
                }
            }
            
            makeMove(position) {
                if (!this.gameActive || !this.isMyTurn || this.board[position] !== '') {
                    return;
                }
                
                this.board[position] = this.playerSymbol;
                this.currentPlayer = this.playerSymbol === 'X' ? 'O' : 'X';
                this.isMyTurn = false;
                
                this.updateBoard();
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ö–æ–¥ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫—É
                this.sendData({
                    type: 'move',
                    position: position,
                    symbol: this.playerSymbol
                });
                
                this.checkGameStatus();
            }
            
            sendData(data) {
                if (this.conn && this.conn.open) {
                    this.conn.send(data);
                }
            }
            
            checkGameStatus() {
                const winCombinations = [
                    [0, 1, 2], [3, 4, 5], [6, 7, 8],
                    [0, 3, 6], [1, 4, 7], [2, 5, 8],
                    [0, 4, 8], [2, 4, 6]
                ];
                
                for (let combo of winCombinations) {
                    const [a, b, c] = combo;
                    if (this.board[a] && this.board[a] === this.board[b] && this.board[a] === this.board[c]) {
                        this.gameActive = false;
                        const winner = this.board[a];
                        this.updateStatus(winner === this.playerSymbol ? '–í—ã –ø–æ–±–µ–¥–∏–ª–∏! üéâ' : '–í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏! üò¢');
                        return;
                    }
                }
                
                if (!this.board.includes('')) {
                    this.gameActive = false;
                    this.updateStatus('–ù–∏—á—å—è! ü§ù');
                    return;
                }
                
                this.updateStatus(this.isMyTurn ? '–í–∞—à —Ö–æ–¥' : '–•–æ–¥ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞');
            }
            
            resetGame() {
                this.board = ['', '', '', '', '', '', '', '', ''];
                this.currentPlayer = 'X';
                this.isMyTurn = this.isHost;
                this.gameActive = true;
                this.updateBoard();
            }
            
            updateBoard() {
                const cells = document.querySelectorAll('.cell');
                cells.forEach((cell, index) => {
                    cell.textContent = this.board[index];
                    cell.className = 'cell';
                    if (this.board[index] === 'X') {
                        cell.classList.add('x');
                    } else if (this.board[index] === 'O') {
                        cell.classList.add('o');
                    }
                });
            }
            
            updateStatus(message) {
                document.getElementById('status').textContent = message;
            }
            
            generateGameId() {
                return Math.random().toString(36).substr(2, 6).toUpperCase();
            }
            
            showGameArea() {
                document.getElementById('lobby').classList.add('hidden');
                document.getElementById('gameArea').classList.remove('hidden');
            }
            
            showLobby() {
                document.getElementById('lobby').classList.remove('hidden');
                document.getElementById('gameArea').classList.add('hidden');
                document.getElementById('joinForm').classList.add('hidden');
            }
            
            disconnect() {
                if (this.conn) {
                    this.conn.close();
                }
                if (this.peer) {
                    this.peer.destroy();
                }
            }
        }

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        const game = new PeerToPeerGame();

        function createGame() {
            game.createGame();
        }

        function showJoinForm() {
            document.getElementById('joinForm').classList.remove('hidden');
        }

        function joinGame() {
            const gameCode = document.getElementById('gameCodeInput').value.trim();
            if (gameCode) {
                game.joinGame(gameCode);
            } else {
                alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–≥—Ä—ã!');
            }
        }

        function makeMove(position) {
            game.makeMove(position);
        }

        function resetGame() {
            game.resetGame();
            game.sendData({ type: 'reset' });
        }

        function leaveGame() {
            game.disconnect();
            game.showLobby();
            game.updateStatus('–û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...');
        }
    </script>
</body>
</html>